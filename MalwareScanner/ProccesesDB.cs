using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Common;

namespace MalwareScanner
{
    //public enum LevelOfSecurity  {None, Information, Warning, Critical }
    public class CounterAndType
    {
        public int Counter { get; set; }
        public LevelOfSecurity LevelOfSecurity { get; set; }
    }
    public class ProccesesDB
    {
        //public static List<string> blackListProccesses = new List<string>();
        public static Dictionary<string, CounterAndType> blackListProccesses = new Dictionary<string, CounterAndType>();

        public void LoadProcesses()
        {
            Dictionary<string, CounterAndType> updatedProcesses = new Dictionary<string, CounterAndType>();

            string configFilePath = "../../BlackListMalwareConfig.txt";

            try
            {
                if (File.Exists(configFilePath))
                {
                    string[] lines = File.ReadAllLines(configFilePath);

                    foreach (var existingProcess in blackListProccesses)
                    {
                        if (lines.Contains(existingProcess.Key))
                        {
                            updatedProcesses[existingProcess.Key] = existingProcess.Value;
                        }
                    }

                    foreach (string processName in lines)
                    {
                        if (!updatedProcesses.ContainsKey(processName))
                        {
                            updatedProcesses[processName] = new CounterAndType { Counter = 0, LevelOfSecurity = LevelOfSecurity.None };
                        }
                    }

                    blackListProccesses.Clear();
                    blackListProccesses = updatedProcesses;
                }
                else
                {
                    blackListProccesses.Clear();
                }

            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading processes: {ex.Message}");
            }
        }
    }

}
